{% extends "base.html" %}

{% block title %}Jobs - ETL System{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
    <h1 class="h2"><i class="bi bi-briefcase"></i> ETL Jobs</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="{{ url_for('jobs.create_job') }}" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Create New Job
        </a>
    </div>
</div>

{% if jobs %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Job Name</th>
                <th>Description</th>
                <th>Source Type</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for job in jobs %}
            <tr>
                <td><strong>{{ job.name }}</strong></td>
                <td>{{ job.description or '-' }}</td>
                <td>
                    <span class="badge bg-{{ 'primary' if job.data_source.source_type == 'csv' else 'info' }}">
                        {{ job.data_source.source_type.upper() }}
                    </span>
                </td>
                <td><small>{{ job.created_at.strftime('%Y-%m-%d %H:%M') }}</small></td>
                <td>
                    <div class="btn-group btn-group-sm" role="group">
                        <a href="{{ url_for('jobs.view_job', job_id=job.id) }}" class="btn btn-outline-primary" title="View Job">
                            <i class="bi bi-eye"></i>
                        </a>
                        <form method="POST" action="{{ url_for('etl.run_etl', job_id=job.id) }}" style="display: inline;">
                            <button type="submit" class="btn btn-outline-success" title="Run ETL">
                                <i class="bi bi-play-circle"></i>
                            </button>
                        </form>
                        <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ job.id }}" title="Delete Job">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                    
                    <!-- Delete Confirmation Modal -->
                    <div class="modal fade" id="deleteModal{{ job.id }}" tabindex="-1">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Confirm Delete</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    Are you sure you want to delete the job "{{ job.name }}"? This action cannot be undone.
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <form method="POST" action="{{ url_for('jobs.delete_job', job_id=job.id) }}" style="display: inline;">
                                        <button type="submit" class="btn btn-danger">Delete</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info">
    <i class="bi bi-info-circle"></i> No jobs found. <a href="{{ url_for('jobs.create_job') }}">Create your first job</a>
</div>
{% endif %}
{% endblock %}
